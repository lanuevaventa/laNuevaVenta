<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/png" href="img/lnvVioleta.png">
  <title>Mi Cuenta - La Nueva Venta</title>
  <link rel="stylesheet" href="css/styles.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
</head>
<body>
  <nav class="navbar fixed-top pt-3 pb-3 ps-4 pe-4 shadow-sm border-bottom">
    <div class="container-fluid d-flex justify-content-end">
      <a class="navbar-brand p-0 me-2 flex-shrink-0" href="index.html">
        <img src="img/lnvBlanco.png" alt="logo" style="height: 45px;">
      </a>
      <form class="flex-grow-1 position-relative me-2" role="search" style="max-width: 100%;">
        <input class="form-control rounded-pill ps-3 pe-5 border-violeta" type="search" placeholder="Buscar..." aria-label="Buscar" style="min-width: 0;">
        <button type="submit" class="btn position-absolute end-0 text-violeta lupa-btn" style="border: none;">
          <i class="bi bi-search"></i>
        </button>
      </form>
      <div class="d-flex align-items-center gap-2 flex-shrink-0">
        <div class="dropdown">
          <button class="btn btn-login-dropdown dropdown-toggle text-cream"
                  type="button"
                  id="dropdownLogin"
                  data-bs-toggle="dropdown"
                  aria-expanded="false"
                  >
            <i class="bi bi-person fs-5"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end bg-navbar" id="dropdownOpciones" aria-labelledby="dropdownLogin">
            <!-- Las opciones se insertarán aquí con JS -->
          </ul>
        </div>
        <a href="carrito.html" class="position-relative text-cream">
          <i class="bi bi-cart"></i>
        </a>
      </div>
    </div>
  </nav>
  <main style="margin-top: 110px;">
   
    <section class="row">
      <div>
        <h1 class="text-center mb-4">Mi Cuenta</h1>
        <p class="text-center">Aquí puedes ver y gestionar los productos que has subido.</p>
        
        <div class="text-center mb-4">
          <button href="cambiarContraseña" class="btn btn-violeta">Modificar Cuenta</button>
       </div>
      <div class="container">
        <h2 class="mb-4">Mis productos subidos</h2>
        <div id="misProductos" class="row g-3"></div>
      </div>
    </section>
  </main>
  <script src="js/script.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Mostrar productos subidos por el usuario logueado
    function renderMisProductos() {
      const usuario = JSON.parse(localStorage.getItem('usuarioLogueado'));
      const productos = JSON.parse(localStorage.getItem('productos')) || [];
      const cont = document.getElementById('misProductos');
      if (!usuario) {
        cont.innerHTML = '<div class="alert alert-warning">Debes iniciar sesión para ver tus productos.</div>';
        return;
      }
      // Filtrar productos por email del usuario
      const mios = productos.filter(p => p.email === usuario.email);
      if (mios.length === 0) {
        cont.innerHTML = '<div class="alert alert-info">No has subido productos aún.</div>';
        return;
      }
      cont.innerHTML = mios.map(prod => `
        <div class="col-md-4">
          <div class="card h-100">
            <img src="${prod.imagen}" class="card-img-top" alt="${prod.nombre}">
            <div class="card-body">
              <h5 class="card-title">${prod.nombre}</h5>
              <p class="card-text">${prod.descripcion}</p>
              <p class="card-text fw-bold">$${prod.precio.toFixed(2)}</p>
              <p class="card-text"><small>Stock: ${prod.stock ?? '-'}</small></p>
              <button class="btn btn-danger btn-sm w-100 mt-2" onclick="borrarProducto(${prod.id})">
                <i class="bi bi-trash"></i> Borrar
              </button>
            </div>
          </div>
        </div>
      `).join('');
    }

    // Borrar producto por id
    function borrarProducto(id) {
      if (!confirm('¿Seguro que quieres borrar este producto?')) return;
      let productos = JSON.parse(localStorage.getItem('productos')) || [];
      productos = productos.filter(p => p.id !== id);
      localStorage.setItem('productos', JSON.stringify(productos));
      renderMisProductos();
    }

    document.addEventListener('DOMContentLoaded', renderMisProductos);
  </script>
</body>
</html>